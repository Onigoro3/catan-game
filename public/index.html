<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catan AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="modal-layer">
        <div id="login-screen">
            <h2>カタンへようこそ</h2>
            <div id="connection-status">サーバー接続中...</div>
            <input type="text" id="username" placeholder="名前 (例: おに)">
            <div class="tab-container">
                <button onclick="showTab('join')" id="tab-join" class="tab-btn active">部屋に入る</button>
                <button onclick="showTab('create')" id="tab-create" class="tab-btn">部屋を作る</button>
            </div>
            <div id="form-join" class="form-content">
                <div class="input-group"><label>部屋名</label><input type="text" id="join-roomname" placeholder="例: room1"></div>
                <button onclick="joinGame()" class="action-btn join-color">参加する</button>
            </div>
            <div id="form-create" class="form-content" style="display:none;">
                <div class="input-group"><label>部屋名</label><input type="text" id="create-roomname" placeholder="新しい部屋名"></div>
                <div class="setting-grid">
                    <div class="setting-item">
                        <label>募集人数(Bot以外)</label>
                        <select id="human-limit"><option value="1">自分のみ</option><option value="2">2人</option><option value="3">3人</option><option value="4" selected>4人</option><option value="5">5人</option><option value="6">6人</option></select>
                    </div>
                    <div class="setting-item"><label>Bot追加</label><select id="bot-count"><option value="0">なし</option><option value="1" selected>1体</option><option value="2">2体</option><option value="3">3体</option><option value="4">4体</option></select></div>
                    <div class="setting-item"><label>Bot強さ</label><select id="bot-diff"><option value="weak">初級</option><option value="normal" selected>中級</option><option value="strong">上級</option></select></div>
                    <div class="setting-item"><label>マップ</label><select id="map-type"><option value="standard">定型</option><option value="random">ランダム</option></select></div>
                    <div class="setting-item"><label>サイズ</label><select id="map-size"><option value="normal" selected>標準</option><option value="extended">拡張</option></select></div>
                    <div class="setting-item"><label>勝利点</label><select id="vp-goal"><option value="10" selected>10点</option><option value="12">12点</option></select></div>
                    <div class="setting-item" style="width:100%"><label>バースト(7)</label><select id="burst-flag"><option value="true" selected>あり</option><option value="false">なし</option></select></div>
                </div>
                <button onclick="createRoom()" class="action-btn create-color">部屋を作って参加</button>
            </div>
            <div class="skin-select-container"><label>見た目: </label><select id="skin-select" onchange="changeSkin(this.value)"><option value="normal">ノーマル</option><option value="dark">ダーク</option><option value="retro">レトロ</option></select></div>
        </div>
        <div id="start-overlay" style="display:none;">
            <div class="overlay-content">
                <h2>準備完了</h2>
                <div id="room-info-display"></div>
                <button onclick="copyInviteLink()" class="sub-btn">🔗 招待URLコピー</button>
                <button id="start-btn-big" onclick="startGame()" class="pulse-button">ゲーム開始</button>
            </div>
        </div>
        <div id="dice-anim-overlay" style="display:none;"><div class="dice-box"><div id="die1" class="die">?</div><div id="die2" class="die">?</div></div></div>
        <div id="burst-overlay" style="display:none;"><div class="overlay-content"><h3 style="color:red;">手札過多！</h3><p>半分(<span id="burst-count">0</span>枚)捨ててください</p><div id="burst-selector"></div><button onclick="submitBurst()" class="pulse-button">捨てる</button></div></div>
        <div id="trade-req-overlay" style="display:none;"><div class="overlay-content"><h3>交渉</h3><p><span id="req-sender"></span>の提案</p><div class="trade-offer-view"><span id="req-give"></span> ➡ <span id="req-receive"></span></div><div class="btn-row"><button onclick="answerTrade(true)" class="accept-btn">承諾</button><button onclick="answerTrade(false)" class="reject-btn">拒否</button></div></div></div>
        <div id="winner-overlay" style="display:none;"><div class="overlay-content"><h1 id="winner-name"></h1><div id="result-stats"></div><button onclick="location.reload()" class="pulse-button">トップへ戻る</button></div></div>
    </div>
    <div id="ui-layer">
        <div id="mobile-header"><div id="mobile-game-info">待機中...</div><div id="timer-display">90</div><button id="menu-btn" onclick="toggleMenu()">☰</button></div>
        <div id="side-menu" class="hidden"><div class="menu-content"><button class="close-btn" onclick="toggleMenu()">×</button><button onclick="copyInviteLink()" class="menu-action-btn">🔗 招待URL</button><div class="panel-box"><h3>詳細</h3><div id="mobile-my-res"></div><div id="mobile-my-cards"></div></div><div class="panel-box"><h3>銀行</h3><div id="mobile-bank-res"></div></div><div class="panel-box"><h3>生産力</h3><div id="mobile-prod-list"></div></div><div class="panel-box"><h3>スコア</h3><div id="mobile-score-board"></div></div><div class="panel-box"><h3>ログ</h3><div id="mobile-log-area"></div></div><div class="panel-box center-box"><label>音量</label><input type="range" id="mobile-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)"><button onclick="resetGame()" class="reset-btn">リセット</button></div></div></div>
        <div id="chat-container"><div id="chat-messages"></div><div class="chat-input-row"><input type="text" id="chat-input" placeholder="チャット"><button onclick="sendChat()">送</button></div></div>
        <div id="pc-info-panel"><div class="panel-box center-box time-box">⏰ <span id="pc-timer">90</span></div><div class="panel-box"><h3>銀行</h3><div id="pc-bank-res"></div></div><div class="panel-box"><h3>資源</h3><div id="pc-my-res"></div></div><div class="panel-box"><h3>カード</h3><div id="pc-my-cards"></div></div><div class="panel-box"><h3>スコア</h3><div id="pc-score-board"></div></div><div class="panel-box"><h3>生産力</h3><div id="pc-prod-list"></div></div><div class="panel-box center-box"><input type="range" id="pc-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)"><button onclick="resetGame()" class="reset-btn">リセット</button><button onclick="copyInviteLink()" class="invite-btn">招待URL</button></div></div>
        <div id="pc-log-container"><h3>ログ</h3><div id="pc-log-area"></div></div>
        <div id="pc-cost-table"><h3>建設</h3><div class="cost-item"><button class="build-btn" onclick="setBuildMode('road')">道</button><span class="cost-res">🌲🧱</span></div><div class="cost-item"><button class="build-btn" onclick="setBuildMode('settlement')">開拓</button><span class="cost-res">🌲🧱🌾🐑</span></div><div class="cost-item"><button class="build-btn" onclick="setBuildMode('city')">都市</button><span class="cost-res">🌾🌾⛰️⛰️⛰️</span></div><div class="cost-item"><button class="build-btn" onclick="buyCard()">カード</button><span class="cost-res">🌾🐑⛰️</span></div><div id="pc-build-msg"></div></div>
        <div id="pc-status-bar"><h2>Catan</h2><div id="pc-game-info">待機中...</div></div>
        <div id="controls" style="display:none;"><div id="action-msg"></div><div id="mobile-build-icons"><button class="m-b-btn" onclick="setBuildMode('road')">🛣️</button><button class="m-b-btn" onclick="setBuildMode('settlement')">🏠</button><button class="m-b-btn" onclick="setBuildMode('city')">🏰</button><button class="m-b-btn" onclick="buyCard()">🃏</button></div><div id="main-controls" style="display:none;"><div class="control-row"><div class="control-group dice-group"><button id="roll-btn" onclick="playDiceAnim()">🎲</button><button id="end-turn-btn" onclick="endTurn()" disabled>終了</button></div><div class="control-group trade-group"><div class="trade-ui"><select id="trade-target"></select><select id="trade-give"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select>➡<select id="trade-receive"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select><button id="trade-btn" onclick="sendTrade()" disabled>交換</button></div><div id="trade-rate-msg">4:1</div></div></div></div></div>
        <div id="mobile-mini-status"><div id="mini-res"></div><div id="mini-score"></div></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catan AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="modal-layer">
        <div id="login-screen">
            <h2>カタンへようこそ</h2>
            <div id="connection-status">サーバー接続中...</div>
            <input type="text" id="username" placeholder="名前">
            
            <div style="display:flex; margin-top:10px; border-bottom:1px solid #ccc;">
                <button onclick="showTab('join')" id="tab-join" style="flex:1; background:#ddd; color:black; border-radius:5px 5px 0 0;">部屋に入る</button>
                <button onclick="showTab('create')" id="tab-create" style="flex:1; background:white; color:black; border-radius:5px 5px 0 0;">部屋を作る</button>
            </div>

            <div id="form-join" style="padding:15px; background:#f9f9f9; border-radius:0 0 10px 10px;">
                <input type="text" id="join-roomname" placeholder="部屋名 (例: room1)">
                <button onclick="joinGame()" style="margin-top:15px; width:100%; background:#4CAF50; color:white;">参加する</button>
            </div>

            <div id="form-create" style="padding:15px; background:#f9f9f9; border-radius:0 0 10px 10px; display:none; text-align:left;">
                <input type="text" id="create-roomname" placeholder="部屋名を決める" style="width:100%; margin-bottom:10px;">
                
                <div class="setting-row"><label>募集人数(人間)</label><select id="human-limit"><option value="1">1人</option><option value="2">2人</option><option value="3">3人</option><option value="4" selected>4人</option><option value="5">5人</option><option value="6">6人</option></select></div>
                <div class="setting-row"><label>Bot追加</label><select id="bot-count"><option value="0" selected>なし</option><option value="1">1体</option><option value="2">2体</option><option value="3">3体</option><option value="4">4体</option></select></div>
                <div class="setting-row"><label>Bot難易度</label><select id="bot-diff"><option value="weak">初級</option><option value="normal" selected>中級</option><option value="strong">上級</option></select></div>
                <div class="setting-row"><label>マップサイズ</label><select id="map-size"><option value="normal" selected>標準(～4人)</option><option value="extended">拡張(～6人)</option></select></div>
                <div class="setting-row"><label>マップ形状</label><select id="map-type"><option value="standard">定型</option><option value="random">ランダム</option></select></div>
                <div class="setting-row"><label>勝利点</label><select id="vp-goal"><option value="8">8点</option><option value="10" selected>10点</option><option value="12">12点</option><option value="15">15点</option></select></div>
                <div class="setting-row"><label>バースト(7)</label><select id="burst-flag"><option value="true" selected>あり</option><option value="false">なし</option></select></div>

                <button onclick="createRoom()" style="margin-top:15px; width:100%; background:#FF5722; color:white;">部屋を作成して参加</button>
            </div>
            
            <div style="margin-top:10px; text-align:center;">
                <label>スキン:</label>
                <select id="skin-select" onchange="changeSkin(this.value)">
                    <option value="normal">ノーマル</option>
                    <option value="dark">ダーク</option>
                    <option value="retro">レトロ</option>
                </select>
            </div>
        </div>

        <div id="start-overlay" style="display:none;">
            <div class="overlay-content">
                <h2>準備完了</h2>
                <div id="room-info-display" style="font-size:12px; color:#555; margin-bottom:10px;"></div>
                <button onclick="copyInviteLink()" style="background:#008CBA; font-size:14px; margin-bottom:10px;">🔗 招待URLコピー</button>
                <button id="start-btn-big" onclick="startGame()" class="pulse-button">ゲーム開始</button>
            </div>
        </div>
        <div id="dice-anim-overlay" style="display:none;"><div class="dice-box"><div id="die1" class="die">?</div><div id="die2" class="die">?</div></div></div>
        <div id="burst-overlay" style="display:none;">
            <div class="overlay-content">
                <h3 style="color:red;">手札過多！(バースト)</h3>
                <p>半分(<span id="burst-count">0</span>枚)捨ててください</p>
                <div id="burst-selector"></div>
                <button onclick="submitBurst()" class="pulse-button">捨てる</button>
            </div>
        </div>
        <div id="trade-req-overlay" style="display:none;">
            <div class="overlay-content">
                <h3>交渉申し込み</h3>
                <p><span id="req-sender"></span> からの提案</p>
                <p>相手: <span id="req-give"></span> ➡ あなた: <span id="req-receive"></span></p>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button onclick="answerTrade(true)" style="background:#4CAF50;">承諾</button>
                    <button onclick="answerTrade(false)" style="background:#f44336;">拒否</button>
                </div>
            </div>
        </div>
        <div id="winner-overlay" style="display:none;">
            <div class="overlay-content">
                <h1 id="winner-name"></h1>
                <div id="result-stats" style="text-align:left; max-height:200px; overflow-y:auto;"></div>
                <button onclick="location.reload()" class="pulse-button">トップへ戻る</button>
            </div>
        </div>
    </div>

    <div id="ui-layer">
        <div id="mobile-header">
            <div id="mobile-game-info">待機中...</div>
            <div id="timer-display" style="font-weight:bold; color:red; margin-left:10px;">90</div>
            <button id="menu-btn" onclick="toggleMenu()">☰ メニュー</button>
        </div>
        <div id="side-menu" class="hidden">
            <div class="menu-content">
                <button class="close-btn" onclick="toggleMenu()">×</button>
                <div class="panel-box"><button onclick="copyInviteLink()" style="width:100%; background:#008CBA;">🔗 招待URL</button></div>
                <div class="panel-box"><h3>詳細</h3><div id="mobile-my-res"></div><div id="mobile-my-cards"></div></div>
                <div class="panel-box"><h3>銀行</h3><div id="mobile-bank-res"></div></div>
                <div class="panel-box"><h3>生産力</h3><div id="mobile-prod-list"></div></div>
                <div class="panel-box"><h3>スコア</h3><div id="mobile-score-board"></div></div>
                <div class="panel-box"><h3>ログ</h3><div id="mobile-log-area"></div></div>
                <div class="panel-box" style="text-align:center;">
                    <label>音量</label><input type="range" id="mobile-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)">
                    <button onclick="resetGame()" style="background:#666; margin-top:10px;">リセット</button>
                </div>
            </div>
        </div>
        <div id="chat-container">
            <div id="chat-messages"></div>
            <div style="display:flex;"><input type="text" id="chat-input"><button onclick="sendChat()">送</button></div>
        </div>
        <div id="pc-info-panel">
            <div class="panel-box" style="text-align:center; font-size:20px; font-weight:bold; color:red;">⏰ <span id="pc-timer">90</span></div>
            <div class="panel-box"><h3>銀行</h3><div id="pc-bank-res"></div></div>
            <div class="panel-box"><h3>資源</h3><div id="pc-my-res"></div></div>
            <div class="panel-box"><h3>カード</h3><div id="pc-my-cards"></div></div>
            <div class="panel-box"><h3>スコア</h3><div id="pc-score-board"></div></div>
            <div class="panel-box"><h3>生産力</h3><div id="pc-prod-list"></div></div>
            <div class="panel-box" style="text-align:center;">
                <input type="range" id="pc-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)">
                <button onclick="resetGame()" style="background:#666; width:100%; margin-top:5px;">リセット</button>
                <button onclick="copyInviteLink()" style="background:#008CBA; width:100%; margin-top:5px;">招待URL</button>
            </div>
        </div>
        <div id="pc-log-container"><h3>ログ</h3><div id="pc-log-area"></div></div>
        <div id="pc-cost-table">
            <h3>建設</h3>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('road')">道</button><span class="cost-res">🌲🧱</span></div>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('settlement')">開拓</button><span class="cost-res">🌲🧱🌾🐑</span></div>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('city')">都市</button><span class="cost-res">🌾🌾⛰️⛰️⛰️</span></div>
            <div class="cost-item"><button class="build-btn" onclick="buyCard()">カード</button><span class="cost-res">🌾🐑⛰️</span></div>
            <div id="pc-build-msg"></div>
        </div>
        <div id="pc-status-bar"><h2>Catan</h2><div id="pc-game-info">待機中...</div></div>
        <div id="controls" style="display:none;">
            <div id="action-msg"></div>
            <div id="mobile-build-icons">
                <button class="m-b-btn" onclick="setBuildMode('road')">🛣️</button>
                <button class="m-b-btn" onclick="setBuildMode('settlement')">🏠</button>
                <button class="m-b-btn" onclick="setBuildMode('city')">🏰</button>
                <button class="m-b-btn" onclick="buyCard()">🃏</button>
            </div>
            <div id="main-controls" style="display:none;">
                <div class="control-row">
                    <div class="control-group dice-group">
                        <button id="roll-btn" onclick="playDiceAnim()">🎲</button>
                        <button id="end-turn-btn" onclick="endTurn()" disabled>終了</button>
                    </div>
                    <div class="control-group trade-group">
                        <div class="trade-ui">
                            <select id="trade-target"></select>
                            <select id="trade-give"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select>
                            ➡ <select id="trade-receive"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select>
                            <button id="trade-btn" onclick="sendTrade()" disabled>交換</button>
                        </div>
                        <div id="trade-rate-msg" style="font-size:10px; color:#555;">4:1</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="mobile-mini-status"><div id="mini-res"></div><div id="mini-score"></div></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>
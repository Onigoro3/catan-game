<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catan AI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="modal-layer">
        <div id="login-screen">
            <h2>カタンへようこそ</h2>
            <div id="connection-status">サーバー接続中...</div>
            <input type="text" id="username" placeholder="名前 (例: おに)">
            <input type="text" id="roomname" placeholder="部屋名 (例: room1) ※空欄でランダム" style="margin-top:10px;">
            <div style="margin-top:10px;">
                <label>プレイ人数: </label>
                <select id="player-count">
                    <option value="2">2人</option>
                    <option value="3">3人</option>
                    <option value="4" selected>4人</option>
                    <option value="5">5人 (拡張)</option>
                    <option value="6">6人 (拡張)</option>
                </select>
            </div>
            <button id="join-btn" onclick="joinGame()" style="margin-top:15px;" disabled>参加する</button>
        </div>
        <div id="start-overlay" style="display:none;">
            <div class="overlay-content">
                <h2>準備完了</h2>
                <button id="start-btn-big" onclick="startGame()" class="pulse-button">ゲーム開始</button>
            </div>
        </div>
        <div id="dice-anim-overlay" style="display:none;">
            <div class="dice-box"><div id="die1" class="die">?</div><div id="die2" class="die">?</div></div>
        </div>
        <div id="winner-overlay" style="display:none;">
            <div class="overlay-content">
                <h1 id="winner-name"></h1>
                <p>の勝利です！</p>
                <button onclick="location.reload()" class="pulse-button">もう一度遊ぶ</button>
            </div>
        </div>
    </div>

    <div id="ui-layer">
        <div id="mobile-header">
            <div id="mobile-game-info">待機中...</div>
            <button id="menu-btn" onclick="toggleMenu()">☰ メニュー</button>
        </div>
        <div id="side-menu" class="hidden">
            <div class="menu-content">
                <button class="close-btn" onclick="toggleMenu()">×</button>
                <div class="panel-box"><h3>あなたの詳細</h3><div id="mobile-my-res"></div><div id="mobile-my-cards"></div></div>
                <div class="panel-box"><h3>🏦 銀行</h3><div id="mobile-bank-res"></div></div>
                <div class="panel-box"><h3>生産力</h3><div id="mobile-prod-list"></div></div>
                <div class="panel-box"><h3>スコア</h3><div id="mobile-score-board"></div></div>
                <div class="panel-box"><h3>ログ</h3><div id="mobile-log-area"></div></div>
                <div class="panel-box" style="text-align:center;">
                    <label>音量</label><input type="range" id="mobile-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)">
                    <br><br><button onclick="resetGame()" style="background:#666;font-size:12px;">リセット</button>
                </div>
            </div>
        </div>
        <div id="pc-log-container"><h3>ゲームログ</h3><div id="pc-log-area"></div></div>
        <div id="pc-cost-table">
            <h3>建設</h3>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('road')">道</button><span class="cost-res">🌲🧱</span></div>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('settlement')">開拓地</button><span class="cost-res">🌲🧱🌾🐑</span></div>
            <div class="cost-item"><button class="build-btn" onclick="setBuildMode('city')">都市</button><span class="cost-res">🌾🌾⛰️⛰️⛰️</span></div>
            <div class="cost-item"><button class="build-btn" onclick="buyCard()">カード</button><span class="cost-res">🌾🐑⛰️</span></div>
            <div id="pc-build-msg" style="color:red;font-size:12px;"></div>
        </div>
        <div id="pc-info-panel">
            <div class="panel-box"><h3>🏦 銀行</h3><div id="pc-bank-res"></div></div>
            <div class="panel-box"><h3>🎒 資源</h3><div id="pc-my-res"></div></div>
            <div class="panel-box"><h3>🃏 カード</h3><div id="pc-my-cards"></div></div>
            <div class="panel-box"><h3>🏆 スコア</h3><div id="pc-score-board"></div></div>
            <div class="panel-box"><h3>生産力</h3><div id="pc-prod-list"></div></div>
            <div class="panel-box" style="text-align:center;"><h3>🔊 音量</h3><input type="range" id="pc-volume" min="0" max="1" step="0.1" value="0.3" onchange="syncVolume(this.value)"></div>
        </div>
        <div id="pc-status-bar"><h2>Catan</h2><div id="pc-game-info">待機中...</div></div>
        <div id="controls" style="display:none;">
            <div id="action-msg"></div>
            <div id="mobile-build-icons">
                <button class="m-b-btn" onclick="setBuildMode('road')">🛣️<br>道</button>
                <button class="m-b-btn" onclick="setBuildMode('settlement')">🏠<br>開拓</button>
                <button class="m-b-btn" onclick="setBuildMode('city')">🏰<br>都市</button>
                <button class="m-b-btn" onclick="buyCard()">🃏<br>カード</button>
            </div>
            <div id="main-controls" style="display:none;">
                <div class="control-row">
                    <div class="control-group dice-group">
                        <div class="group-title">アクション</div>
                        <button id="roll-btn" onclick="playDiceAnim()">🎲 サイコロ</button>
                        <button id="end-turn-btn" onclick="endTurn()" disabled>終了</button>
                    </div>
                    <div class="control-group trade-group">
                        <div class="group-title">🏦 貿易</div>
                        <div class="trade-ui">
                            <select id="trade-give"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select>
                            ➡ <select id="trade-receive"><option value="forest">🌲</option><option value="hill">🧱</option><option value="mountain">⛰️</option><option value="field">🌾</option><option value="pasture">🐑</option></select>
                            <button id="trade-btn" onclick="sendTrade()" disabled>交換</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="mobile-mini-status"><div id="mini-res"></div><div id="mini-score"></div></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>